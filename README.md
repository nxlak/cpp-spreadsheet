# Электронная таблица

## Дипломный проект в рамках обучения на курсе Яндекс Практикум

**Spreadsheet** – это упрощенный аналог существующих решений электронных таблиц, таких как *Microsoft Excel* или *Google Sheets*. Ячейки таблицы могут содержать текст или формулы. Формулы в свою очередь могут содержать индексы ячеек, как и в упомянутых продуктах. Спроектированный проект таблицы обладает высокой эффективностью по памяти (в случае «разреженности» таблицы, когда минимальная печатная область велика по сравнению с количеством непустых ячеек), не вызывает утечек памяти при удалении ячеек или таблицы целиком, а также предоставляет доступ к своим ячейкам по индексу за `О(1)`.

## Описание

### Ячейки и индексы

Таблица хранит в себе ячейки `Cell`. Для пользователя ячейка таблицы задаётся своим индексом, то есть строкой вида `А1`, `С14` или `RD2`. Причём ячейка с индексом `А1` — это ячейка в левом верхнем углу листа.
Количество строк и столбцов в таблице не превышает **16384**. То есть предельная позиция ячейки равна `(16383, 16383)` с индексом `XFD16384`. Если позиция ячейки выходит за эти границы, то ячейка невалидна по определению. Структура ***позиции*** определена в файле `common.h` и содержит поля `col` и `row` – индексы строк и столбцов, используемые для доступа к ячейкам листа.

### Минимальная печатная область

Чтобы напечатать таблицу, нужно знать размер минимальной печатной области. Это минимальная прямоугольная область с вершиной в ячейке `A1`, содержащая все непустые ячейки.
Структура `Size` определена в файле `common.h`. Она содержит количество строк и столбцов в минимальной печатной области.

### Методы, обращающиеся к ячейке по индексу

* `SetCell(Position, std::string)` – задаёт содержимое ячейки по индексу `Position`. Если ячейка пуста – она создаётся. Нужно задать ячейке текст методом `Cell::Set(std::string)`;
* `Cell\* GetCell(Position pos)` – константный и неконстантный геттеры, которые возвращают указатель на ячейку, расположенную по индексу `pos`. Если ячейка пуста, возвращают `nullptr`;
* `void ClearCell(Position pos)` – очищает ячейку по индексу. Последующий вызов `GetCell()` для этой ячейки вернёт `nullptr`. При этом может измениться размер минимальной печатной области.

### Методы, применимые к таблице целиком

* `Size GetPrintableSize()` – определяет размер минимальной печатной области. Специально для него в файле `common.h` определена структура `Size`. Она содержит количество строк и столбцов в минимальной печатной области;
* `void PrintText(std::ostream&)` – выводит текстовые представления ячеек:
	* для текстовых ячеек – это текст, который пользователь задал в методе `Set()`, то есть не очищенный от ведущих апострофов `'`;
	* для формульных ячеек – это формула, очищенная от лишних скобок, как `Formula::GetExpression()`, но с ведущим знаком `=`.
* `void PrintValues(std::ostream&)` – выводит значения ячеек — строки, числа или `FormulaError`, — как это определено в `Cells::GetValue()`.

### Вычисление значений в ячейках

Допустим, в ячейке `А3` находится формула `=1+2*7`. Её легко вычислить: это `15`. В ячейке `A2` находится текст `3`. Формально ячейка не формульная. Но её текст можно интерпретировать как число. Поэтому её значение – `3`. В ячейке `С2` записана формула `=A3/A2`. Чтобы её вычислить, надо разделить значение ячейки `А3` на значение ячейки `А2`. Результат – 15/3 = **5**.
Если формула содержит индекс пустой ячейки, то значение пустой ячейки — 0.

## Обработка исключений

### Ошибки вычисления

В вычислениях могут возникнуть ошибки. Например, ошибка «деление на 0». Если делитель равен 0, значение ячейки — ошибка `FormulaError` типа **#DIV/0!**.

Если ячейку, чей индекс входит в формулу, нельзя проинтерпретировать как число, возникает ошибка `FormulaError` — нет значения **#VALUE!**.

Формула может содержать ссылку на ячейку, которая выходит за границы возможного размера таблицы, например `С2 (=А1234567+ZZZZ1)`. Такая формула может быть создана, но не может быть вычислена, поэтому её вычисление вернёт ошибку **#REF!**.

Ошибки распространяются вверх по зависимостям. Если формула зависит от нескольких ячеек, каждая из которых содержит ошибку вычисления, результирующая ошибка может соответствовать любой из них.

### Некорректная формула

Если в ячейку методом `Sheet::SetCell()` записать синтаксически некорректную формулу, например `=A1+*`, то программа генерирует исключение `FormulaException`, и значение ячейки не меняется. Формула считается синтаксически некорректной, если она не удовлетворяет общепринятой грамматике.

### Некорректная позиция

Программно возможно создать экземпляр класса `Position` c некорректной позицией, например `(-1, -1)`. Если пользователь передаёт её в методы, программа генерирует исключение `InvalidPositionException`.

### Циклические зависимости

Таблица остаётся корректной при возникновении циклических зависимостей. Если ячейки циклически зависят друг от друга, то невозможно вычислить значения ячеек. Поэтому пользователь не может задать ячейку в методе `Sheet::SetCell()` с формулой, которая вводит циклические зависимости. Программа генерирует исключение `CircularDependencyException`, и значение ячейки не меняется.

## Системные требования
1. С++ 17
2. GCC(MinGW-w64) 11+
3. JDK – Java Development Kit https://www.oracle.com/java/technologies/downloads/
4. Библиотека ANTLR4 https://www.antlr.org/
5. CMake version 3.8+ https://cmake.org/

## Порядок установки

1. Установить CMake и JDK.
2. Установить ANTLR. Инструкцию по установке ANTLR можно найти на сайте https://www.antlr.org/.
3. Создать каталоги Debug и Release, если они ещё не созданы:

```
mkdir ../Debug
mkdir ../Release
```

4. Перейти в каталог `spreadsheet` и выполнить команду для `Debug`- и/или `Release`-конфигурации:

```
cmake -E chdir ../Debug/ cmake -G "Unix Makefiles" ../spreadsheet/ -DCMAKE_BUILD_TYPE:STRING=Debug
cmake -E chdir ../Release/ cmake -G "Unix Makefiles" ../spreadsheet/ -DCMAKE_BUILD_TYPE:STRING=Release 
```

5. Перейти в каталог `Debug` или `Release` и собрать проект:

```
cmake --build .
```

6. Запустить программу:

```
./spreadsheet
```
